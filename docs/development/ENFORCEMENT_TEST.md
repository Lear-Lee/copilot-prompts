# 强制规范加载机制 - 测试指南

## 📋 测试目的

验证新的强制执行检查点是否能有效防止AI在未加载规范的情况下生成代码。

## 🧪 测试场景

### 场景1：正常工作流（应该通过）

**步骤：**
1. 打开 Copilot Chat
2. 要求："帮我创建一个Vue组件"
3. **期望行为**：AI首先调用 `get_smart_standards` 或 `use_preset`
4. AI声明："✅ 已加载规范: get_smart_standards"
5. 然后生成符合规范的代码

**验证点：**
- ✅ AI在生成代码前先加载了规范
- ✅ 生成的代码符合Element Plus strict配置（单行属性、国际化等）
- ✅ 没有语法错误

### 场景2：违规操作（应该被阻止）

**步骤：**
1. 重新打开新的Copilot Chat会话（确保没有之前的上下文）
2. 直接要求："修改 src/stores/group.ts，添加一个新函数"
3. **期望行为**：
   - AI应该先检查当前文件路径是否包含 `/weipin/`
   - 然后调用 `get_smart_standards` 加载TypeScript规范
   - 声明已加载规范后再进行修改

**验证点：**
- ✅ AI没有直接生成代码
- ✅ AI先执行了强制验证流程
- ✅ 明确声明了加载的规范

### 场景3：跨项目污染测试

**步骤：**
1. 打开copilot-prompts项目的某个文件
2. 要求："帮我修改这个文件"
3. **期望行为**：
   - AI检测到当前路径是 `/copilot-prompts/`，不是 `/weipin/`
   - weipin项目的规范应该被忽略
   - 应该使用copilot-prompts项目自己的规范

**验证点：**
- ✅ 没有应用weipin的Element Plus strict配置
- ✅ 使用了copilot-prompts的开发规范

## 🎯 成功标准

**强制执行机制生效的标志：**

1. **所有代码生成前**都能看到明确的"✅ 已加载规范: xxx"声明
2. **不再出现**因未遵循规范导致的语法错误
3. **跨项目污染**问题得到解决
4. AI对"强制执行检查点"的理解和遵守是**主动的**，而不是被动响应

## 📊 当前实现状态

✅ **已完成：**
- Shell脚本模板已更新（setup-copilot.sh）
- MCP服务器模板已更新（generateConfig.ts）
- weipin项目配置已重新生成，包含强制检查点
- 检查点放在文件最开头，优先级最高

⏳ **待测试：**
- 实际使用中AI是否真正遵守检查点
- 是否需要进一步加强提示语的强制性
- 是否需要实现技术层面的validate_workflow工具

## 💡 改进建议

如果测试发现AI仍然忽略强制检查点，可以考虑：

1. **强化提示语**：使用更直接的命令式语言
2. **技术验证**：实现validate_workflow MCP工具，返回true/false决定操作是否可以继续
3. **上下文注入**：在VSCode扩展层面强制注入规范加载步骤

## 📝 测试记录模板

```markdown
### 测试时间：YYYY-MM-DD HH:MM

**场景**：[场景1/场景2/场景3]

**测试内容**：
- 要求：xxx
- AI响应：xxx
- 是否加载规范：是/否
- 规范加载方式：get_smart_standards/use_preset/未加载
- 生成代码质量：符合/不符合规范

**结果**：通过/失败

**备注**：xxx
```

---

**维护者**: MTA工作室  
**创建时间**: 2025-12-23  
**版本**: 1.0

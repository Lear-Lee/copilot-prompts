# v1.3.0 测试指南

## 测试环境

- VSCode 版本: >= 1.85.0
- Node.js 版本: >= 18.0.0
- 插件版本: 1.3.0

---

## 🧪 测试清单

### 1. 基础功能测试

#### 1.1 插件激活
- [ ] 打开 VSCode 后插件自动激活
- [ ] 侧边栏显示 Copilot Prompts 图标
- [ ] 状态栏显示当前配置数量

#### 1.2 配置选择
- [ ] 展开 Agents 和 Prompts 分类
- [ ] 勾选/取消勾选配置项
- [ ] 配置立即生效并显示提示

---

### 2. 新增检查功能测试

#### 2.1 工作区冲突检测

**测试步骤**:
1. 打开包含多个项目的工作区（如当前工作区）
2. 确保至少 2 个项目有 `.github/copilot-instructions.md`
3. 运行命令: `Copilot Prompts: 检查配置问题`

**预期结果**:
- ⚠️ 显示工作区冲突警告
- 列出所有配置文件位置
- 提供 3 个解决方案：
  1. 查看冲突详情
  2. 备份非活动项目配置
  3. 为每个项目创建独立配置

**验证点**:
- [ ] 正确识别多个配置文件
- [ ] 准确标识当前生效的项目
- [ ] 解决方案可正常执行

---

#### 2.2 Agent 文件完整性检查

**测试步骤**:
1. 创建测试文件: `d:\Work\RN\copilot-prompts\agents\test-incomplete.agent.md`
2. 内容只写标题，不添加 frontmatter
3. 运行检查命令

**预期结果**:
- ❌ 显示 "Agent 文件缺少 frontmatter" 错误
- 提供解决方案：
  1. 添加模板 frontmatter
  2. 查看文件

**验证点**:
- [ ] 检测到缺失的 frontmatter
- [ ] 自动添加功能正常工作
- [ ] 生成的模板符合规范

**测试文件内容**:
```markdown
# 测试 Agent
这是一个测试文件
```

**修复后预期内容**:
```markdown
---
description: '描述信息'
tools: ['edit', 'search']
---

# 测试 Agent
这是一个测试文件
```

---

#### 2.3 Prompt 文件完整性检查

**测试步骤**:
1. 创建测试文件: `d:\Work\RN\copilot-prompts\common\test-short.md`
2. 只写 10 个字符的内容
3. 运行检查命令

**预期结果**:
- ℹ️ 显示 "Prompt 文件内容较少" 信息
- 提供编辑文件的解决方案

**验证点**:
- [ ] 检测到内容过少
- [ ] 可以直接打开文件编辑
- [ ] 不会误报正常文件

---

#### 2.4 引用关系检查

**测试步骤**:
1. 编辑 `d:\Work\RN\copilot-prompts\agents\vitasage.agent.md`
2. 添加一个不存在的引用: `prompts/common/nonexistent.md`
3. 运行检查命令

**预期结果**:
- ❌ 显示 "Agent 引用的 Prompt 不存在" 错误
- 提供 3 个解决方案：
  1. 创建缺失的 Prompt
  2. 移除引用
  3. 查看所有可用 Prompts

**验证点**:
- [ ] 正确识别不存在的引用
- [ ] 创建功能生成文件框架
- [ ] 查看可用 Prompts 列表正确

**测试引用**:
```markdown
参考: prompts/common/nonexistent.md
```

---

#### 2.5 文件格式检查

**测试步骤**:
1. 创建错误命名的文件: `d:\Work\RN\copilot-prompts\agents\wrong-name.md`
2. 运行检查命令

**预期结果**:
- ⚠️ 显示 "文件命名不规范" 警告
- 提供 2 个解决方案：
  1. 重命名为 Agent 格式 (.agent.md)
  2. 移动到 prompts 目录

**验证点**:
- [ ] 识别命名不规范的文件
- [ ] 重命名功能正常
- [ ] 移动功能正确处理路径

---

#### 2.6 重复文件检测

**测试步骤**:
1. 在不同目录创建同名文件:
   - `d:\Work\RN\copilot-prompts\common\duplicate.md`
   - `d:\Work\RN\copilot-prompts\industry\duplicate.md`
2. 运行检查命令

**预期结果**:
- ⚠️ 显示 "发现重复的文件名" 警告
- 列出所有重复文件位置
- 提供 3 个解决方案：
  1. 查看所有重复文件
  2. 对比文件内容
  3. 重命名以区分

**验证点**:
- [ ] 正确检测重复文件
- [ ] 对比功能打开 diff 视图
- [ ] 不区分大小写检测

---

#### 2.7 备份文件处理

**测试步骤**:
1. 手动创建备份文件: 
   - 复制 `.github/copilot-instructions.md` 
   - 重命名为 `.github/copilot-instructions.md.backup`
2. 运行检查命令

**预期结果**:
- ℹ️ 显示 "发现备份文件" 信息
- 提供 3 个解决方案：
  1. 恢复备份
  2. 查看备份内容（对比）
  3. 删除备份

**验证点**:
- [ ] 检测到备份文件
- [ ] 恢复功能正常（包含确认对话框）
- [ ] 对比功能打开 diff 视图
- [ ] 删除功能包含确认

---

### 3. 界面交互测试

#### 3.1 问题分组显示

**测试步骤**:
1. 创建多种类型的问题（参考上面的测试）
2. 运行检查命令

**预期结果**:
- 问题按类别分组显示
- 每个分组有图标标识
- 显示问题统计信息

**验证点**:
- [ ] 工作区问题分组 `$(workspace)`
- [ ] 文件问题分组 `$(file)`
- [ ] 引用问题分组 `$(link)`
- [ ] 格式问题分组 `$(symbol-ruler)`
- [ ] 重复问题分组 `$(copy)`
- [ ] 统计数字正确

---

#### 3.2 解决方案选择

**测试步骤**:
1. 选择任意一个检测到的问题
2. 查看解决方案列表

**预期结果**:
- 显示该问题的所有解决方案
- 每个方案有清晰的标签和描述
- 可以执行选中的方案

**验证点**:
- [ ] 解决方案列表完整显示
- [ ] 描述文字清晰
- [ ] 执行后有反馈提示
- [ ] 可以返回问题列表

---

#### 3.3 批量修复

**测试步骤**:
1. 创建多个可自动修复的问题
2. 选择 "批量修复所有问题"

**预期结果**:
- 显示可修复问题数量
- 需要用户确认
- 执行后显示成功/失败统计

**验证点**:
- [ ] 正确识别可修复问题
- [ ] 显示确认对话框
- [ ] 批量执行成功
- [ ] 统计数字准确
- [ ] 显示修复结果

---

#### 3.4 导出报告

**测试步骤**:
1. 确保有多个检测到的问题
2. 选择 "导出检查报告"

**预期结果**:
- 生成 Markdown 格式报告
- 文件名包含时间戳
- 提示是否打开文件

**验证点**:
- [ ] 报告文件创建成功
- [ ] 文件名格式: `copilot-prompts-check-YYYY-MM-DD-HH-mm-ss.md`
- [ ] 报告内容完整（包含所有问题）
- [ ] 问题按类别分组
- [ ] 相关文件路径正确
- [ ] 解决方案列出完整

**报告结构检查**:
```markdown
# Copilot Prompts 配置检查报告

生成时间: YYYY-MM-DD HH:mm:ss

## 问题概览
- ❌ 错误: X 个
- ⚠️ 警告: X 个
- ℹ️ 信息: X 个

## 工作区问题
### ⚠️ 问题标题
**详情**: ...
**相关文件**:
- `路径1`
**解决方案**:
- 方案1
- 方案2

## 文件问题
...
```

---

### 4. 兼容性测试

#### 4.1 向后兼容

**测试步骤**:
1. 使用旧版本的工作区
2. 加载插件

**验证点**:
- [ ] 旧配置文件正常识别
- [ ] 不破坏现有配置
- [ ] 所有旧功能正常工作

#### 4.2 多工作区支持

**测试场景**:
- 单项目工作区
- 多项目工作区
- 没有配置文件的工作区

**验证点**:
- [ ] 所有场景都能正常检查
- [ ] 不会崩溃或报错
- [ ] 提示信息准确

---

### 5. 性能测试

#### 5.1 大型工作区

**测试条件**:
- 包含 10+ 个项目的工作区
- 100+ 个 Agent/Prompt 文件

**验证点**:
- [ ] 检查速度 < 5 秒
- [ ] 不阻塞 UI
- [ ] 内存占用正常

#### 5.2 重复检查

**测试步骤**:
1. 连续执行 3 次检查命令
2. 观察响应时间

**验证点**:
- [ ] 每次检查结果一致
- [ ] 没有内存泄漏
- [ ] 响应时间稳定

---

## 🐛 已知问题

### 问题 1: TypeScript 编译警告
- **描述**: 可能出现类型推断警告
- **影响**: 仅编译时警告，不影响功能
- **修复**: 下个版本优化

### 问题 2: 路径分隔符
- **描述**: Windows 路径使用 `\`，报告中显示可能不统一
- **影响**: 仅显示问题，功能正常
- **修复**: 已考虑路径标准化

---

## 📊 测试报告模板

```
测试人员: ________
测试日期: ________
插件版本: 1.3.0
VSCode 版本: ________

### 测试通过率

- [ ] 基础功能: __/4
- [ ] 检查功能: __/7
- [ ] 界面交互: __/4
- [ ] 兼容性: __/2
- [ ] 性能: __/2

总计: __/19

### 发现的问题

1. 
2. 
3. 

### 改进建议

1. 
2. 
3. 
```

---

## 🚀 测试后步骤

### 清理测试文件

删除所有测试创建的文件：
```bash
# 删除测试 Agent
rm "d:\Work\RN\copilot-prompts\agents\test-incomplete.agent.md"
rm "d:\Work\RN\copilot-prompts\agents\wrong-name.md"

# 删除测试 Prompt
rm "d:\Work\RN\copilot-prompts\common\test-short.md"
rm "d:\Work\RN\copilot-prompts\common\duplicate.md"
rm "d:\Work\RN\copilot-prompts\industry\duplicate.md"

# 删除测试备份
rm ".github\copilot-instructions.md.backup"

# 删除生成的报告
rm copilot-prompts-check-*.md
```

### 恢复修改

如果测试中修改了 `vitasage.agent.md`，记得恢复原始内容。

---

## 💡 测试技巧

1. **使用专用测试工作区**: 避免影响生产环境
2. **逐个测试**: 不要一次创建所有测试文件，分步骤测试
3. **记录问题**: 发现问题立即记录，包含重现步骤
4. **对比行为**: 与 v1.2.0 对比，确保没有退化
5. **边界测试**: 测试极端情况（空文件、超大文件等）

---

**祝测试顺利！** 🎉

# VS Code æ’ä»¶é‡æ„æ–¹æ¡ˆ - é…ç½®æ–‡ä»¶é©±åŠ¨ + ç²¾ç®€è¾“å‡º

## ğŸ¯ æ ¸å¿ƒéœ€æ±‚

### 1. é…ç½®æ–‡ä»¶ç®¡ç†
- âœ… å•ä¸€é…ç½®æ–‡ä»¶ï¼ˆå¦‚ `agents-config.json`ï¼‰
- âœ… åˆ†æ¨¡å—ç®¡ç†ä¸åŒè¯­è¨€/æ¡†æ¶çš„ agent
- âœ… æ”¯æŒå¤–éƒ¨é“¾æ¥ + æœ¬åœ°æ‰“åŒ…ï¼ˆåŒé‡ä¿éšœï¼‰
- âœ… è‡ªåŠ¨åŒ¹é…ï¼Œæ— éœ€æ‰‹åŠ¨é€‰æ‹©

### 2. ç²¾ç®€è¾“å‡º
- âœ… ç”Ÿæˆçš„ `copilot-instructions.md` æç®€åŒ–
- âœ… åªåŒ…å«å¼•ç”¨æˆ–å…³é”®è§„åˆ™
- âœ… ä½¿ç”¨æ¨¡å—åŒ–å¯¼å…¥æœºåˆ¶

### 3. UI ç®€åŒ–
- âœ… ç§»é™¤ agent é€‰æ‹©ç•Œé¢
- âœ… åªæ˜¾ç¤ºé¡¹ç›®çŠ¶æ€ï¼ˆå·²é…ç½®/æœªé…ç½®ï¼‰
- âœ… ä¸€é”®è‡ªåŠ¨é…ç½®æŒ‰é’®
- âœ… é…ç½®è¯¦æƒ…å¯æŠ˜å å±•ç¤º

---

## ğŸ“ æ–°æ¶æ„è®¾è®¡

### æ–¹æ¡ˆ Aï¼šå¼•ç”¨å¼ï¼ˆæ¨èï¼‰â­

**copilot-instructions.md å†…å®¹**ï¼š
```markdown
<!-- Auto-generated by Copilot Prompts Manager -->

# é¡¹ç›®é…ç½®

> æœ¬æ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆï¼Œè¯·å‹¿æ‰‹åŠ¨ç¼–è¾‘

## åº”ç”¨çš„è§„èŒƒ

<!-- @import /Users/pailasi/.copilot-agents/vue3.agent.md -->
<!-- @import /Users/pailasi/.copilot-agents/typescript.agent.md -->
<!-- @import /Users/pailasi/.copilot-agents/vitasage.agent.md -->

---

ç”Ÿæˆæ—¶é—´: 2025-12-12 16:00:00
é…ç½®ç‰ˆæœ¬: 1.0.0
```

**ä¼˜åŠ¿**ï¼š
- âœ… æ–‡ä»¶æå°ï¼ˆ< 500 bytesï¼‰
- âœ… Agent å†…å®¹é›†ä¸­ç®¡ç†åœ¨ `~/.copilot-agents/`
- âœ… æ›´æ–° agent æ— éœ€ä¿®æ”¹é¡¹ç›®æ–‡ä»¶
- âœ… Copilot ä¼šè‡ªåŠ¨è¯»å–å¼•ç”¨çš„æ–‡ä»¶

**æŠ€æœ¯å®ç°**ï¼š
```typescript
// ç”Ÿæˆå¼•ç”¨å¼é…ç½®
function generateReferenceConfig(matches: AgentMatch[]) {
  const imports = matches.map(m => 
    `<!-- @import ${getAgentPath(m.agent.id)} -->`
  ).join('\n');
  
  return `<!-- Auto-generated -->\n\n${imports}`;
}
```

---

### æ–¹æ¡ˆ Bï¼šå†…è”ç²¾ç®€å¼

**copilot-instructions.md å†…å®¹**ï¼š
```markdown
# é¡¹ç›®è§„èŒƒæ‘˜è¦

## æŠ€æœ¯æ ˆ
- Vue 3 + Composition API
- TypeScript (strict mode)
- Element Plus

## æ ¸å¿ƒè§„åˆ™
1. é›¶ `any` ç±»å‹
2. æ‰€æœ‰æ–‡æœ¬ä½¿ç”¨ `$t()` å›½é™…åŒ–
3. API è°ƒç”¨ä½¿ç”¨ `api.$method`
4. ç»„ä»¶ä½¿ç”¨ `<script setup lang="ts">`

è¯¦ç»†è§„èŒƒ: ~/.copilot-agents/[vue3|typescript|vitasage].agent.md
```

**ä¼˜åŠ¿**ï¼š
- âœ… åªåŒ…å«å…³é”®è§„åˆ™ï¼ˆ< 2KBï¼‰
- âœ… å¿«é€ŸæŸ¥çœ‹æ ¸å¿ƒè¦æ±‚
- âœ… è¯¦ç»†å†…å®¹å¼•ç”¨å¤–éƒ¨æ–‡ä»¶

---

### æ–¹æ¡ˆ Cï¼šé…ç½®æ–‡ä»¶é©±åŠ¨ï¼ˆæœ€çµæ´»ï¼‰â­â­

**é¡¹ç›®é…ç½®æ–‡ä»¶** `.copilot/config.json`ï¼š
```json
{
  "version": "1.0.0",
  "agents": ["vue3", "typescript", "i18n", "vitasage"],
  "rules": {
    "strict": true,
    "i18n": {
      "required": true,
      "function": "$t"
    },
    "api": {
      "alias": "@api",
      "pattern": "api.$method"
    }
  }
}
```

**copilot-instructions.md**ï¼š
```markdown
<!-- Config: .copilot/config.json -->
# è‡ªåŠ¨é…ç½®é¡¹ç›®

è¯¦è§é…ç½®æ–‡ä»¶: `.copilot/config.json`
```

**ä¼˜åŠ¿**ï¼š
- âœ… æè‡´ç²¾ç®€ï¼ˆ< 200 bytesï¼‰
- âœ… é…ç½®ç»“æ„åŒ–ï¼Œæ˜“äºç®¡ç†
- âœ… æ”¯æŒç‰ˆæœ¬æ§åˆ¶
- âœ… å¯ç¼–ç¨‹åŒ–å¤„ç†

---

## ğŸ—‚ï¸ Agent å­˜å‚¨ç­–ç•¥

### æœ¬åœ°ç¼“å­˜ç›®å½•ç»“æ„

```
~/.copilot-agents/
â”œâ”€â”€ config.json              # å…¨å±€é…ç½®
â”œâ”€â”€ cache/                   # ä» GitHub ä¸‹è½½çš„ç¼“å­˜
â”‚   â”œâ”€â”€ vue3.agent.md
â”‚   â”œâ”€â”€ typescript.agent.md
â”‚   â””â”€â”€ i18n.agent.md
â””â”€â”€ bundled/                 # æ’ä»¶å†…ç½®ï¼ˆç¦»çº¿å¯ç”¨ï¼‰
    â”œâ”€â”€ vue3.agent.md
    â”œâ”€â”€ typescript.agent.md
    â””â”€â”€ common.agent.md
```

### åŠ è½½ä¼˜å…ˆçº§

```
1. æœ¬åœ°ç¼“å­˜ (cache/) - æœ€æ–°ç‰ˆæœ¬
   â†“ å¦‚æœä¸å­˜åœ¨æˆ–è¿‡æœŸ
2. æ’ä»¶å†…ç½® (bundled/) - ç¦»çº¿å¯ç”¨
   â†“ åå°å¼‚æ­¥
3. GitHub åŠ¨æ€è·å– - æ›´æ–°ç¼“å­˜
```

### é…ç½®æ–‡ä»¶æ ¼å¼

**~/.copilot-agents/config.json**ï¼š
```json
{
  "version": "1.0.0",
  "updatePolicy": "auto",  // auto | manual | offline
  "cacheExpiry": 86400,    // 24å°æ—¶
  "agents": {
    "vue3": {
      "name": "Vue 3 Agent",
      "description": "Vue 3 + TypeScript + Composition API",
      "tags": ["vue3", "typescript", "composition-api"],
      "source": "github",  // github | bundled | local
      "url": "https://raw.githubusercontent.com/.../vue3.agent.md",
      "bundled": true,     // æ˜¯å¦æ‰“åŒ…åˆ°æ’ä»¶ä¸­
      "priority": 10,
      "matchRules": {
        "frameworks": ["vue3", "vue"],
        "languages": ["typescript"],
        "files": ["vite.config.ts", "vue.config.js"]
      }
    },
    "typescript": {
      "name": "TypeScript Strict",
      "tags": ["typescript", "type-safety"],
      "source": "bundled",
      "bundled": true,
      "priority": 8,
      "matchRules": {
        "languages": ["typescript"],
        "files": ["tsconfig.json"]
      }
    }
  }
}
```

---

## ğŸ¨ UI é‡æ–°è®¾è®¡

### å½“å‰ UIï¼ˆå¾…ç§»é™¤ï¼‰
```
ğŸ“‚ Prompts
  ğŸ“„ Vue 3 Agent          [âœ“]
  ğŸ“„ TypeScript Agent     [âœ“]
  ğŸ“„ i18n Agent          [ ]
  
ğŸ“‚ Projects
  ğŸ“ VitaSage            [å·²é…ç½®]
  ğŸ“ weipin              [æœªé…ç½®]
```

### æ–° UIï¼ˆç²¾ç®€ç‰ˆï¼‰
```
ğŸ“Š é…ç½®çŠ¶æ€
  âœ… VitaSage           [æŸ¥çœ‹] [æ›´æ–°]
  âš ï¸ weipin             [è‡ªåŠ¨é…ç½®]
  âš ï¸ Omipay.userCenter  [è‡ªåŠ¨é…ç½®]
  
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš¡ æ‰¹é‡æ“ä½œ
  [âœ¨ è‡ªåŠ¨é…ç½®æ‰€æœ‰é¡¹ç›®]
  [ğŸ”„ æ›´æ–°æ‰€æœ‰é…ç½®]
  [âš™ï¸ ç®¡ç† Agent åº“]
```

### é¡¹ç›®è¯¦æƒ…ï¼ˆç‚¹å‡»å±•å¼€ï¼‰
```
ğŸ“ VitaSage - å·²é…ç½®
  
  ğŸ¯ åŒ¹é…çš„ Agents (3ä¸ª)
    â€¢ Vue 3 Agent (åŒ¹é…åº¦: 95%)
    â€¢ TypeScript Strict (åŒ¹é…åº¦: 90%)
    â€¢ i18n Agent (åŒ¹é…åº¦: 85%)
  
  ğŸ“„ é…ç½®æ–‡ä»¶
    .copilot/config.json
  
  ğŸ“Š æŠ€æœ¯æ ˆåˆ†æ
    æ¡†æ¶: Vue 3.4.0
    è¯­è¨€: TypeScript 5.3
    å·¥å…·: Vite, Element Plus, LogicFlow
  
  ğŸ”§ æ“ä½œ
    [ğŸ“ ç¼–è¾‘é…ç½®] [ğŸ”„ é‡æ–°ç”Ÿæˆ] [ğŸ—‘ï¸ åˆ é™¤é…ç½®]
```

---

## ğŸ”§ æŠ€æœ¯å®ç°æ–¹æ¡ˆ

### 1. Agent ç®¡ç†å™¨ï¼ˆæ–°å¢ï¼‰

```typescript
// src/core/AgentManager.ts

interface AgentConfig {
  name: string;
  description: string;
  tags: string[];
  source: 'github' | 'bundled' | 'local';
  url?: string;
  bundled: boolean;
  priority: number;
  matchRules: MatchRules;
}

class AgentManager {
  private configPath: string;
  private cachePath: string;
  private bundledPath: string;
  
  constructor() {
    this.configPath = path.join(os.homedir(), '.copilot-agents', 'config.json');
    this.cachePath = path.join(os.homedir(), '.copilot-agents', 'cache');
    this.bundledPath = path.join(__dirname, '../bundled-agents');
  }
  
  // åŠ è½½ agentï¼ˆä¼˜å…ˆçº§ï¼šcache > bundled > githubï¼‰
  async loadAgent(id: string): Promise<string> {
    // 1. å°è¯•ç¼“å­˜
    const cached = await this.loadFromCache(id);
    if (cached && !this.isCacheExpired(id)) {
      return cached;
    }
    
    // 2. ä½¿ç”¨å†…ç½®
    const bundled = await this.loadBundled(id);
    
    // 3. åå°æ›´æ–°ï¼ˆä¸é˜»å¡ï¼‰
    this.updateCacheInBackground(id);
    
    return bundled;
  }
  
  // è‡ªåŠ¨åŒ¹é… agents
  async matchAgents(projectPath: string): Promise<AgentConfig[]> {
    const features = await this.analyzeProject(projectPath);
    const config = await this.loadConfig();
    
    const matches = Object.entries(config.agents)
      .map(([id, agent]) => ({
        id,
        agent,
        score: this.calculateScore(features, agent.matchRules)
      }))
      .filter(m => m.score > 50)
      .sort((a, b) => b.score - a.score);
    
    return matches.map(m => m.agent);
  }
}
```

### 2. é…ç½®ç”Ÿæˆå™¨ï¼ˆé‡æ„ï¼‰

```typescript
// src/core/ConfigGenerator.ts

type OutputMode = 'reference' | 'inline' | 'config-driven';

class ConfigGenerator {
  private mode: OutputMode = 'reference'; // é»˜è®¤å¼•ç”¨å¼
  
  // ç”Ÿæˆå¼•ç”¨å¼é…ç½®
  generateReference(agents: AgentConfig[]): string {
    const imports = agents.map(a => 
      `<!-- @import ${this.getAgentPath(a.id)} -->`
    ).join('\n');
    
    return `<!-- Auto-generated by Copilot Prompts Manager -->
<!-- Do not edit manually -->

# Project Configuration

${imports}

---
Generated: ${new Date().toISOString()}
`;
  }
  
  // ç”Ÿæˆé…ç½®æ–‡ä»¶é©±åŠ¨å¼
  generateConfigDriven(agents: AgentConfig[], projectPath: string): void {
    const configPath = path.join(projectPath, '.copilot', 'config.json');
    const config = {
      version: '1.0.0',
      agents: agents.map(a => a.id),
      rules: this.extractRules(agents)
    };
    
    fs.writeFileSync(configPath, JSON.stringify(config, null, 2));
    
    // copilot-instructions.md åªæ˜¯ä¸€ä¸ªå…¥å£
    const instructions = `<!-- Config: .copilot/config.json -->
# Auto-configured Project

See configuration file: \`.copilot/config.json\`
`;
    
    fs.writeFileSync(
      path.join(projectPath, '.github', 'copilot-instructions.md'),
      instructions
    );
  }
}
```

### 3. UI ç»„ä»¶ï¼ˆé‡æ„ï¼‰

```typescript
// src/ui/ProjectStatusView.ts

class ProjectStatusView implements vscode.TreeDataProvider<ProjectItem> {
  getChildren(element?: ProjectItem): ProjectItem[] {
    if (!element) {
      // æ ¹çº§ï¼šæ˜¾ç¤ºæ‰€æœ‰é¡¹ç›®
      return this.getAllProjects().map(project => ({
        label: project.name,
        status: this.getProjectStatus(project),
        collapsibleState: vscode.TreeItemCollapsibleState.Collapsed
      }));
    } else {
      // å±•å¼€ï¼šæ˜¾ç¤ºé¡¹ç›®è¯¦æƒ…
      return this.getProjectDetails(element);
    }
  }
  
  private getProjectStatus(project: WorkspaceFolder): ProjectStatus {
    const configExists = fs.existsSync(
      path.join(project.uri.fsPath, '.github', 'copilot-instructions.md')
    );
    
    return {
      configured: configExists,
      agentCount: configExists ? this.countAgents(project) : 0,
      lastUpdate: configExists ? this.getLastUpdate(project) : null
    };
  }
}
```

---

## ğŸ“‹ å®æ–½æ­¥éª¤

### é˜¶æ®µ 1: Agent ç®¡ç†ç³»ç»Ÿï¼ˆ2å°æ—¶ï¼‰
1. âœ… åˆ›å»º `AgentManager` ç±»
2. âœ… å®ç°ç¼“å­˜æœºåˆ¶
3. âœ… æ‰“åŒ…å¸¸ç”¨ agents åˆ°æ’ä»¶
4. âœ… å®ç°è‡ªåŠ¨åŒ¹é…é€»è¾‘

### é˜¶æ®µ 2: é…ç½®ç”Ÿæˆé‡æ„ï¼ˆ1å°æ—¶ï¼‰
1. âœ… æ”¯æŒå¼•ç”¨å¼è¾“å‡º
2. âœ… æ”¯æŒé…ç½®æ–‡ä»¶é©±åŠ¨
3. âœ… ç²¾ç®€ç”Ÿæˆå†…å®¹

### é˜¶æ®µ 3: UI é‡æ–°è®¾è®¡ï¼ˆ1.5å°æ—¶ï¼‰
1. âœ… ç§»é™¤ agent é€‰æ‹©è§†å›¾
2. âœ… å®ç°é¡¹ç›®çŠ¶æ€è§†å›¾
3. âœ… æ·»åŠ ä¸€é”®é…ç½®æŒ‰é’®
4. âœ… æ·»åŠ æ‰¹é‡æ“ä½œ

### é˜¶æ®µ 4: æµ‹è¯•å’Œä¼˜åŒ–ï¼ˆ0.5å°æ—¶ï¼‰
1. âœ… æµ‹è¯•å„ç§é¡¹ç›®ç±»å‹
2. âœ… ä¼˜åŒ–åŒ¹é…ç®—æ³•
3. âœ… å®Œå–„æ–‡æ¡£

---

## ğŸ¯ æ¨èæ–¹æ¡ˆ

**ç»„åˆä½¿ç”¨**ï¼š
- **è¾“å‡ºæ ¼å¼**: æ–¹æ¡ˆ Aï¼ˆå¼•ç”¨å¼ï¼‰+ æ–¹æ¡ˆ Cï¼ˆé…ç½®æ–‡ä»¶é©±åŠ¨ï¼‰
- **å­˜å‚¨ç­–ç•¥**: ä¸‰çº§ç¼“å­˜ï¼ˆcache > bundled > githubï¼‰
- **UI è®¾è®¡**: æ–° UIï¼ˆç²¾ç®€ç‰ˆï¼‰

**ç†ç”±**ï¼š
1. å¼•ç”¨å¼è¾“å‡ºæœ€ç²¾ç®€ï¼Œç¬¦åˆéœ€æ±‚
2. é…ç½®æ–‡ä»¶æä¾›çµæ´»æ€§
3. ä¸‰çº§ç¼“å­˜è§£å†³ç½‘ç»œé—®é¢˜
4. æ–° UI æ›´ç¬¦åˆ"è‡ªåŠ¨é…ç½®"çš„ç†å¿µ

---

## ğŸ’¡ æ‚¨çš„é€‰æ‹©

è¯·ç¡®è®¤ï¼š

1. **è¾“å‡ºæ ¼å¼**: 
   - [ ] A. å¼•ç”¨å¼ï¼ˆæ¨èï¼‰
   - [ ] B. å†…è”ç²¾ç®€å¼
   - [ ] C. é…ç½®æ–‡ä»¶é©±åŠ¨
   - [ ] D. A + C ç»„åˆ

2. **Agent å­˜å‚¨**:
   - [ ] æ‰“åŒ…åˆ°æ’ä»¶ï¼ˆç¦»çº¿ä¼˜å…ˆï¼‰
   - [ ] åŠ¨æ€è·å–ï¼ˆå§‹ç»ˆæœ€æ–°ï¼‰
   - [ ] æ··åˆæ¨¡å¼ï¼ˆæ¨èï¼‰

3. **UI é£æ ¼**:
   - [ ] æ–° UIï¼ˆç²¾ç®€ç‰ˆï¼Œæ¨èï¼‰
   - [ ] ä¿ç•™éƒ¨åˆ†å½“å‰ UI

å‘Šè¯‰æˆ‘æ‚¨çš„é€‰æ‹©ï¼Œæˆ‘ç«‹å³å¼€å§‹å®ç°ï¼
